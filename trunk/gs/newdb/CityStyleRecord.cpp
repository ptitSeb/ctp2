
/*
 * DO NOT EDIT THIS FILE!
 * It is generated automatically by ctpdb
 */
#include "c3.h"
#include "c3errors.h"
#include "CityStyleRecord.h"
#include "DBLexer.h"
#include "DBTokens.h"
#include "CTPDatabase.h"
#include "StrDB.h"
#include "BitArray.h"

#include "AgeCityStyleRecord.h"

CTPDatabase<CityStyleRecord> *g_theCityStyleDB = NULL;

CityStyleRecord::Init()
{
    m_AgeStyle = NULL;
    m_numAgeStyle = 0;
}

CityStyleRecord::~CityStyleRecord()
{
	int index = 0;
	// free array AgeStyle 
 	if (m_numAgeStyle > 0) 
		delete [m_numAgeStyle] m_AgeStyle; 
	m_AgeStyle = NULL; 
	m_numAgeStyle = 0; 

}

void CityStyleRecord::operator=(const CityStyleRecord & rval)
{
	int index = 0;
	m_index = rval.m_index;
	// free array AgeStyle 
 	if (m_numAgeStyle > 0) 
	{
		delete [m_numAgeStyle] m_AgeStyle; 
		m_AgeStyle = NULL; 
		m_numAgeStyle = 0; 
	}
	if (rval.m_numAgeStyle > 0) 
	{
		m_AgeStyle = new sint32 [rval.m_numAgeStyle]; 
		memcpy(m_AgeStyle, rval.m_AgeStyle, sizeof(sint32)*rval.m_numAgeStyle); 

	} 
	m_numAgeStyle = rval.m_numAgeStyle;

}

char *g_CityStyle_Tokens[] =
{
    "AgeStyle",
};

CityStyleRecordAccessorInfo g_CityStyleRecord_Accessors[] = 
{
    { NULL, NULL, NULL, NULL, NULL}, /* AgeStyle (array) */
};

#define k_Token_CityStyle_AgeStyle               ((k_Token_Custom_Base) + 0)
#define k_Token_CityStyle_Max                    ((k_Token_Custom_Base) + 1)


static BitArray s_ParsedTokens(1);
void CityStyleRecord::CheckRequiredFields(DBLexer *lex)
{
    // Ick.
}
    
sint32 CityStyleRecord::Parse(DBLexer *lex)
{
    bool done = false;
    sint32 result = 0;
    sint32 tok;
    DBPARSE_ERROR err = DBPARSE_OK;
    s_ParsedTokens.Clear();
    lex->SetTokens(g_CityStyle_Tokens, k_Token_CityStyle_Max);
    tok = lex->GetToken();
    if(tok != k_Token_Name) {
        DBERROR(("Record does not start with name"));
        return 0;
    }
    if(!g_theStringDB->GetStringID(lex->GetTokenText(), m_name)) {
        g_theStringDB->InsertStr(lex->GetTokenText(), lex->GetTokenText());
        if(!g_theStringDB->GetStringID(lex->GetTokenText(), m_name))
            SetTextName(lex->GetTokenText());
    }

    tok = lex->GetToken();
    if(tok != k_Token_OpenBrace) {
        DBERROR(("Missing open brace"));
        return 0;
    }

    while(!done) {
        tok = lex->GetToken();
        if(tok >= k_Token_Custom_Base && tok < k_Token_CityStyle_Max) { 
            s_ParsedTokens.SetBit(tok - k_Token_Custom_Base);
        }
        switch(tok) {
            case k_Token_CityStyle_AgeStyle:
                if(!g_theAgeCityStyleDB->ParseRecordInArray(lex, (sint32 **)&m_AgeStyle, &m_numAgeStyle, err)) 
                {
                    done = true; break;
                }
                break;
            case k_Token_CloseBrace:
                done = true;
                result = 1;
                break;
            default:
                DBERROR(("Unknown token"));
                done = true;
                break;
        }
    }
    CheckRequiredFields(lex);
    lex->RestoreTokens();
    return result;
}

void CityStyleRecord::ResolveDBReferences()
{
    {
        sint32 i;
        for(i = 0; i < m_numAgeStyle; i++) {
            if(m_AgeStyle[i] & 0x80000000) {
                sint32 id = m_AgeStyle[i] & 0x7fffffff;
                if(!g_theAgeCityStyleDB->GetNamedItem(id, m_AgeStyle[i])) {
                    c3errors_ErrorDialog("DB", "%s not found in AgeCityStyle database", g_theStringDB->GetNameStr(id));
                }
            } else if(m_AgeStyle[i] == 0x7fffffff){
                m_AgeStyle[i] = -1;
            }
        }
    }
}
/*
 * Member class Parsers
 * (DO NOT EDIT!  Automatically generated file)
 */
/*
 * Data Parsers
 * (DO NOT EDIT!  Automatically generated file)
 */
void CityStyleRecord::Merge(const CityStyleRecord & rval){
	int index = 0, obj_index = 0;
	// resize m_AgeStyle if necessary
	if (rval.m_numAgeStyle > m_numAgeStyle)
 	{ 
		delete m_AgeStyle;
 		m_AgeStyle = NULL;
 		if (rval.m_numAgeStyle > 0)
 			m_AgeStyle = new sint32 [rval.m_numAgeStyle]; 
		m_numAgeStyle = rval.m_numAgeStyle;
 	} 

	// copy values of rval.m_AgeStyle to m_AgeStyle
	for (index = 0; index < m_numAgeStyle; index++) 
	{ 
 		if (index < rval.m_numAgeStyle)
 			m_AgeStyle[index] = rval.m_AgeStyle[index];
	} 
 } 

/*
 * Data accessors
 * (DO NOT EDIT!  Automatically generated file)
 */
sint32 CityStyleRecord::GetAgeStyleIndex(sint32 index) const
{
    Assert(index >= 0);
    Assert(index < m_numAgeStyle);
    if((index < 0) || (index >= m_numAgeStyle)) {
        return 0;
    }
    return m_AgeStyle[index];
}

const AgeCityStyleRecord *CityStyleRecord::GetAgeStyle(sint32 index) const
{
    Assert(index >= 0);
    Assert(index < m_numAgeStyle);
    if((index < 0) || (index >= m_numAgeStyle)) {
        return 0;
    }
    return g_theAgeCityStyleDB->Get(m_AgeStyle[index]);
}

